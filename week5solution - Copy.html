<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="demostyle.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
</head>
<body>

<div class="container mt-3">
  <h3>Small Modal Example</h3>
  <p>Click on the button to open the modal.</p>
  
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">
    Open modal
  </button>
  <div class="mt-3">
  	<table class="size">
  		<thead>
  			<tr>
  				<th>ID</th>
  				<th>UserName</th>
  				<th>Password</th>
  				<th>Remenber</th>
  				<th>Action</th>
  			</tr>	
  		</thead>
  		<tbody class="tblbody">
  			
  		</tbody>
  	</table>
  </div>
</div>

<!-- The Modal -->
<div class="modal" id="myModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Modal Heading</h4>
        <button type="button" class="btn-close" onClick="reset()" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <form>
    <div class="mb-3 mt-3">
      <label for="email">Email:</label>
      <input type="email" class="form-control" id="email" placeholder="Enter email" name="email">
    </div>
    <div class="mb-3">
      <label for="pwd">Password:</label>
      <input type="password" class="form-control" id="pwd" placeholder="Enter password" name="pswd">
    </div>
    <div class="form-check mb-3">
      <label class="form-check-label">
        <input id="remember" class="form-check-input" type="checkbox" name="remember"> Remember me
      </label>
    </div>
    <button id="btnsubmit" userId="0" type="button" class="btn btn-primary">Submit</button>
  </form>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" onClick="reset()" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>
<div class="modal" id="deleteModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Delete your Account</h4>
        <button type="button" class="btn-close" onClick="reset()" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3 mt-3">
            <h2 class="text-center">Are you Sure you want to Delete this account!</h2>
          </div>
          <div class="text-center">
              <button id="btndelete" deleteId="0" type="button" class="btn btn-danger">Delete</button>
              <button type="button" class="btn btn-primary" onClick="reset()" data-bs-dismiss="modal">Cancel</button>
        </div>
        </form>
      </div>
    </div>
  </div>
</div>

</body>
<script>
	var array = [];
  $(document).ready(function(){
    _onload();
    displayTable();
  })
  $("#btnsubmit").on("click", function(){
    debugger
    var email = $("#email").val();
    var password = $("#pwd").val();
    var remember = $("#remember").prop("checked");
    array = JSON.parse(localStorage.getItem("UserArray")) == null ? [] : JSON.parse(localStorage.getItem("UserArray"));
    if($(this).attr("userId") != 0){
      var id = $("#btnsubmit").attr("userId");
      
      const newArr = array.map(obj => {
        if(obj.ID == id) {
          return {...obj, email: email,password:password,remember:remember};
        }

        return obj;
      });
debugger
      localStorage.setItem("UserArray", JSON.stringify(newArr));
    }
    else{
        debugger
        var selected = array[array.length -1];
        var arrayObj = {
          ID : selected != undefined ? selected.ID+1 : 1,
          email : email,
          password : password,
          remember : remember
        };

        array.push(arrayObj);
        localStorage.setItem("UserArray", JSON.stringify(array));
    }
    
    reset();
    $("#myModal").modal("hide");
    displayTable();
  });
  function _onload(){
  }

  function reset(){
    $("#email").val("");
    $("#pwd").val("");
    $("#remember").prop("checked",false);
    $("#btnsubmit").attr("userId",0);

  }

  function displayTable(){
    array = JSON.parse(localStorage.getItem("UserArray")) == null ? [] : JSON.parse(localStorage.getItem("UserArray"));

    var html="";
    for (var i = 0; i <= array.length-1 ; i++) {
      var arr = array[i];
      html += "<tr id='"+ arr.ID+"'>";
      html += "<td style='text-align:center;'>" + arr.ID +"</td>";
      html += "<td style='text-align:left;'>"+ arr.email +"</td>";
      html += "<td>"+ arr.password +"</td>";
      html += "<td>"+ arr.remember +"</td>";
      html += "<td style='text-align:center;'><button style='margin-right: 10px;' class='btn btn-primary' onClick='editUser("+arr.ID+")'>Edit</button><button class='btn btn-danger' onClick='deletePopup("+arr.ID+")'>Delete</button></td>";     
      html += "</tr>";
    }
    

    $(".tblbody").html(html);
  }

  function editUser(id){
    array = JSON.parse(localStorage.getItem("UserArray")) == null ? [] : JSON.parse(localStorage.getItem("UserArray"));

    var __FOUND = array.find(function(val, index) {
      if(val.ID == id)
        return true;
    });
    
    $("#email").val(__FOUND.email);
    $("#pwd").val(__FOUND.password);
    $("#remember").prop("checked",__FOUND.remember);
    $("#btnsubmit").attr("userId",id);

    $("#myModal").modal("show");

  }

  function deletePopup(id){
    $("#deleteModal").modal("show");
    $("#btndelete").attr("deleteId",id);
  }

$("#btndelete").on("click",function(){
  var id = $(this).attr("deleteId");
  array = JSON.parse(localStorage.getItem("UserArray")) == null ? [] : JSON.parse(localStorage.getItem("UserArray"));

    for(var i = 0; i < array.length; i++) {
        if(array[i].ID == id) {
            array.splice(i, 1);
            break;
        }
    }
    localStorage.setItem("UserArray", JSON.stringify(array));
    $("#deleteModal").modal("hide");

    displayTable();
})
	</script>
</html>
